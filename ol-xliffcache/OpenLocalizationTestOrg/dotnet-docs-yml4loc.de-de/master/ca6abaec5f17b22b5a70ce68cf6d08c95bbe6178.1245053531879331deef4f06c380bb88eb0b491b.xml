{"nodes":[{"content":"Provides custom wrappers for handling method calls.","nodes":[{"pos":[0,51],"content":"Provides custom wrappers for handling method calls.","nodes":[{"content":"Provides custom wrappers for handling method calls.","pos":[0,51]}]}],"pos":[899,951],"yaml":true},{"content":"A marshaler provides a bridge between the functionality of old and new interfaces. Custom marshaling provides the following benefits:  \n  \n-   It enables client applications that were designed to work with an old interface to also work with servers that implement a new interface.  \n  \n-   It enables client applications built to work with a new interface to work with servers that implement an old interface.  \n  \n If you have an interface that introduces different marshaling behavior or that is exposed to the Component Object Model (COM) in a different way, you can design a custom marshaler instead of using the interop marshaler. By using a custom marshaler, you can minimize the distinction between new .NET Framework components and existing COM components.  \n  \n For example, suppose that you are developing a managed interface called `INew`. When this interface is exposed to COM through a standard COM callable wrapper (CCW), it has the same methods as the managed interface and uses the marshaling rules built into the interop marshaler. Now suppose that a well-known COM interface called `IOld` already provides the same functionality as the `INew` interface. By designing a custom marshaler, you can provide an unmanaged implementation of `IOld` that simply delegates the calls to the managed implementation of the `INew` interface. Therefore, the custom marshaler acts as a bridge between the managed and unmanaged interfaces.  \n  \n> [!NOTE]\n>  Custom marshalers are not invoked when calling from managed code to unmanaged code on a dispatch-only interface.  \n  \n## Defining the Marshaling Type  \n Before you can build a custom marshaler, you must define the managed and unmanaged interfaces that will be marshaled. These interfaces commonly perform the same function but are exposed differently to managed and unmanaged objects.  \n  \n A managed compiler produces a managed interface from metadata, and the resulting interface looks like any other managed interface. The following example shows a typical interface.  \n  \n [!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#1](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#1)]\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#1](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#1)]\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#1](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#1)]  \n  \n You define the unmanaged type in Interface Definition Language (IDL) and compile it with the Microsoft Interface Definition Language (MIDL) compiler. You define the interface within a library statement and assign it an interface ID with the universal unique identifier (UUID) attribute, as the following example demonstrates.  \n  \n```  \n [uuid(9B2BAADA-0705-11D3-A0CD-00C04FA35826)]  \nlibrary OldLib {  \n     [uuid(9B2BAADD-0705-11D3-A0CD-00C04FA35826)]  \n     interface IOld : IUnknown  \n         HRESULT OldMethod();  \n}  \n```  \n  \n The MIDL compiler produces several output files. If the interface is defined in Old.idl, the output file Old_i.c defines a `const` variable with the interface identifier (IID) of the interface, as the following example demonstrates.  \n  \n```  \nconst IID IID_IOld = {0x9B2BAADD,0x0705,0x11D3,{0xA0,0xCD,0x00,0xC0,0x4F,0xA3,0x58,0x26}};  \n```  \n  \n The Old.h file is also produced by MIDL. It contains a C++ definition of the interface that can be included in your C++ source code.  \n  \n## Implementing the ICustomMarshaler Interface  \n Your custom marshaler must implement the <xref:System.Runtime.InteropServices.ICustomMarshaler> interface to provide the appropriate wrappers to the runtime.  \n  \n The following C# code displays the base interface that must be implemented by all custom marshalers.  \n  \n [!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#2](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#2)]\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#2](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#2)]\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#2](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#2)]  \n  \n The <xref:System.Runtime.InteropServices.ICustomMarshaler> interface includes methods that provide conversion support, cleanup support, and information about the data to be marshaled.  \n  \n|Type of operation|ICustomMarshaler method|Description|  \n|-----------------------|-----------------------------|-----------------|  \n|Conversion (from native to managed code)|<xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A>|Marshals a pointer to native data into a managed object. This method returns a custom runtime callable wrapper (RCW) that can marshal the unmanaged interface that is passed as an argument. The marshaler should return an instance of the custom RCW for that type.|  \n|Conversion (from managed to native code)|<xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A>|Marshals a managed object into a pointer to native data. This method returns a custom COM callable wrapper (CCW) that can marshal the managed interface that is passed as an argument. The marshaler should return an instance of the custom CCW for that type.|  \n|Cleanup (of native code)|<xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData%2A>|Enables the marshaler to clean up the native data (the CCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> method.|  \n|Cleanup (of managed code)|<xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData%2A>|Enables the marshaler to clean up the managed data (the RCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> method.|  \n|Information (about native code)|<xref:System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize%2A>|Returns the size of the unmanaged data to be marshaled.|  \n  \n### Conversion  \n <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A?displayProperty=fullName>  \n  \n Marshals a pointer to native data into a managed object. This method returns a custom runtime callable wrapper (RCW) that can marshal the unmanaged interface that is passed as an argument. The marshaler should return an instance of the custom RCW for that type.  \n  \n <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A?displayProperty=fullName>  \n  \n Marshals a managed object into a pointer to native data. This method returns a custom COM callable wrapper (CCW) that can marshal the managed interface that is passed as an argument. The marshaler should return an instance of the custom CCW for that type.  \n  \n### Cleanup  \n <xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData%2A?displayProperty=fullName>  \n  \n Enables the marshaler to clean up the native data (the CCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> method.  \n  \n <xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData%2A?displayProperty=fullName>  \n  \n Enables the marshaler to clean up the managed data (the RCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> method.  \n  \n### Size Information  \n <xref:System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize%2A?displayProperty=fullName>  \n  \n Returns the size of the unmanaged data to be marshaled.  \n  \n## Implementing the GetInstance Method  \n In addition to implementing the <xref:System.Runtime.InteropServices.ICustomMarshaler> interface, custom marshalers must implement a `static` method called `GetInstance` that accepts a <xref:System.String> as a parameter and has a return type of <xref:System.Runtime.InteropServices.ICustomMarshaler>. This `static` method is called by the common language runtime's COM interop layer to instantiate an instance of the custom marshaler. The string that is passed to `GetInstance` is a cookie that the method can use to customize the returned custom marshaler.  \n  \n```  \nstatic ICustomMarshaler *GetInstance(String *pstrCookie);  \n```  \n  \n## Applying MarshalAsAttribute  \n To use a custom marshaler, you must apply the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute to the parameter or field that is being marshaled.  \n  \n You must also pass the <xref:System.Runtime.InteropServices.UnmanagedType?displayProperty=fullName> enumeration value to the <xref:System.Runtime.InteropServices.MarshalAsAttribute>constructor. In addition, you must specify the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field with one of the following named parameters:  \n  \n-   <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> (required): The assembly-qualified name of the custom marshaler. The name should include the namespace and class of the custom marshaler. If the custom marshaler is not defined in the assembly it is used in, you must specify the name of the assembly in which it is defined.  \n  \n    > [!NOTE]\n    >  You can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef> field instead of the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field. <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef> takes a type that is easier to specify.  \n  \n-   <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalCookie> (optional): A cookie that is passed to the custom marshaler. You can use the cookie to provide additional information to the marshaler. For example, if the same marshaler is used to provide a number of wrappers, the cookie identifies a specific wrapper. The cookie is passed to the `GetInstance` method of the marshaler.  \n  \n The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute identifies the custom marshaler so it can activate the appropriate wrapper. The common language runtime's interop service then examines the attribute and creates the custom marshaler the first time the argument (parameter or field) needs to be marshaled.  \n  \n The runtime then calls the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> and <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> methods on the custom marshaler to activate the correct wrapper to handle the call.  \n  \n## Using a Custom Marshaler  \n When the custom marshaler is complete, you can use it as a custom wrapper for a particular type. The following example shows the definition of the `IUserData` managed interface:  \n  \n [!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#3](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#3)]\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#3](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#3)]\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#3](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#3)]  \n  \n In the following example, the `IUserData` interface uses the `NewOldMarshaler` custom marshaler to enable unmanaged client applications to pass an `IOld` interface to the `DoSomeStuff` method. The managed description of the `DoSomeStuff` method takes an `INew` interface, as shown in the previous example, whereas the unmanaged version of `DoSomeStuff` takes an `IOld` interface pointer, as shown in the following example.  \n  \n```  \n[uuid(9B2BAADA-0705-11D3-A0CD-00C04FA35826)]  \nlibrary UserLib {  \n     [uuid(9B2BABCD-0705-11D3-A0CD-00C04FA35826)]  \n     interface IUserData : IUnknown  \n         HRESULT DoSomeStuff(IUnknown* pIOld);  \n}  \n```  \n  \n The type library that is generated by exporting the managed definition of `IUserData` yields the unmanaged definition shown in this example instead of the standard definition. The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute applied to the `INew` argument in the managed definition of the `DoSomeStuff` method indicates that the argument uses a custom marshaler, as the following example shows.  \n  \n [!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#4](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#4)]\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#4](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#4)]\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#4](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#4)]  \n  \n [!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#5](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#5)]\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#5](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#5)]\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#5](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#5)]  \n  \n In the previous examples, the first parameter provided to the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute is the <xref:System.Runtime.InteropServices.UnmanagedType?displayProperty=fullName> enumeration value `UnmanagedType.CustomMarshaler`.  \n  \n The second parameter is the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field, which provides the assembly-qualified name of the custom marshaler. This name consists of the namespace and class of the custom marshaler (`MarshalType=\"MyCompany.NewOldMarshaler\"`).","nodes":[{"pos":[0,133],"content":"A marshaler provides a bridge between the functionality of old and new interfaces. Custom marshaling provides the following benefits:","nodes":[{"content":"A marshaler provides a bridge between the functionality of old and new interfaces. Custom marshaling provides the following benefits:","pos":[0,133],"nodes":[{"content":"A marshaler provides a bridge between the functionality of old and new interfaces.","pos":[0,82]},{"content":"Custom marshaling provides the following benefits:","pos":[83,133]}]}]},{"pos":[143,280],"content":"It enables client applications that were designed to work with an old interface to also work with servers that implement a new interface.","nodes":[{"content":"It enables client applications that were designed to work with an old interface to also work with servers that implement a new interface.","pos":[0,137]}]},{"pos":[290,409],"content":"It enables client applications built to work with a new interface to work with servers that implement an old interface.","nodes":[{"content":"It enables client applications built to work with a new interface to work with servers that implement an old interface.","pos":[0,119]}]},{"pos":[416,764],"content":"If you have an interface that introduces different marshaling behavior or that is exposed to the Component Object Model (COM) in a different way, you can design a custom marshaler instead of using the interop marshaler. By using a custom marshaler, you can minimize the distinction between new .NET Framework components and existing COM components.","nodes":[{"content":"If you have an interface that introduces different marshaling behavior or that is exposed to the Component Object Model (COM) in a different way, you can design a custom marshaler instead of using the interop marshaler. By using a custom marshaler, you can minimize the distinction between new .NET Framework components and existing COM components.","pos":[0,348],"nodes":[{"content":"If you have an interface that introduces different marshaling behavior or that is exposed to the Component Object Model (COM) in a different way, you can design a custom marshaler instead of using the interop marshaler.","pos":[0,219]},{"content":"By using a custom marshaler, you can minimize the distinction between new .NET Framework components and existing COM components.","pos":[220,348]}]}]},{"pos":[771,1440],"content":"For example, suppose that you are developing a managed interface called `INew`. When this interface is exposed to COM through a standard COM callable wrapper (CCW), it has the same methods as the managed interface and uses the marshaling rules built into the interop marshaler. Now suppose that a well-known COM interface called `IOld` already provides the same functionality as the `INew` interface. By designing a custom marshaler, you can provide an unmanaged implementation of `IOld` that simply delegates the calls to the managed implementation of the `INew` interface. Therefore, the custom marshaler acts as a bridge between the managed and unmanaged interfaces.","nodes":[{"content":"For example, suppose that you are developing a managed interface called <ph id=\"ph1\">`INew`</ph>.","pos":[0,79],"source":"For example, suppose that you are developing a managed interface called `INew`."},{"content":"When this interface is exposed to COM through a standard COM callable wrapper (CCW), it has the same methods as the managed interface and uses the marshaling rules built into the interop marshaler.","pos":[80,277]},{"content":"Now suppose that a well-known COM interface called <ph id=\"ph1\">`IOld`</ph> already provides the same functionality as the <ph id=\"ph2\">`INew`</ph> interface.","pos":[278,400],"source":" Now suppose that a well-known COM interface called `IOld` already provides the same functionality as the `INew` interface."},{"content":"By designing a custom marshaler, you can provide an unmanaged implementation of <ph id=\"ph1\">`IOld`</ph> that simply delegates the calls to the managed implementation of the <ph id=\"ph2\">`INew`</ph> interface.","pos":[401,574],"source":" By designing a custom marshaler, you can provide an unmanaged implementation of `IOld` that simply delegates the calls to the managed implementation of the `INew` interface."},{"content":"Therefore, the custom marshaler acts as a bridge between the managed and unmanaged interfaces.","pos":[575,669]}]},{"pos":[1448,1571],"content":"[!NOTE]\n Custom marshalers are not invoked when calling from managed code to unmanaged code on a dispatch-only interface.","leadings":["","> "],"nodes":[{"content":"Custom marshalers are not invoked when calling from managed code to unmanaged code on a dispatch-only interface.","pos":[9,121]}]},{"pos":[1580,1608],"content":"Defining the Marshaling Type","linkify":"Defining the Marshaling Type","nodes":[{"content":"Defining the Marshaling Type","pos":[0,28]}]},{"pos":[1612,1843],"content":"Before you can build a custom marshaler, you must define the managed and unmanaged interfaces that will be marshaled. These interfaces commonly perform the same function but are exposed differently to managed and unmanaged objects.","nodes":[{"content":"Before you can build a custom marshaler, you must define the managed and unmanaged interfaces that will be marshaled. These interfaces commonly perform the same function but are exposed differently to managed and unmanaged objects.","pos":[0,231],"nodes":[{"content":"Before you can build a custom marshaler, you must define the managed and unmanaged interfaces that will be marshaled.","pos":[0,117]},{"content":"These interfaces commonly perform the same function but are exposed differently to managed and unmanaged objects.","pos":[118,231]}]}]},{"pos":[1850,2029],"content":"A managed compiler produces a managed interface from metadata, and the resulting interface looks like any other managed interface. The following example shows a typical interface.","nodes":[{"content":"A managed compiler produces a managed interface from metadata, and the resulting interface looks like any other managed interface. The following example shows a typical interface.","pos":[0,179],"nodes":[{"content":"A managed compiler produces a managed interface from metadata, and the resulting interface looks like any other managed interface.","pos":[0,130]},{"content":"The following example shows a typical interface.","pos":[131,179]}]}]},{"pos":[2036,2571],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#1<ept id=\"p2\">](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#1)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#1<ept id=\"p4\">](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#1)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#1<ept id=\"p6\">](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#1)</ept><ept id=\"p5\">]</ept>","source":"[!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#1](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#1)]\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#1](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#1)]\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#1](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#1)]"},{"pos":[2578,2903],"content":"You define the unmanaged type in Interface Definition Language (IDL) and compile it with the Microsoft Interface Definition Language (MIDL) compiler. You define the interface within a library statement and assign it an interface ID with the universal unique identifier (UUID) attribute, as the following example demonstrates.","nodes":[{"content":"You define the unmanaged type in Interface Definition Language (IDL) and compile it with the Microsoft Interface Definition Language (MIDL) compiler. You define the interface within a library statement and assign it an interface ID with the universal unique identifier (UUID) attribute, as the following example demonstrates.","pos":[0,325],"nodes":[{"content":"You define the unmanaged type in Interface Definition Language (IDL) and compile it with the Microsoft Interface Definition Language (MIDL) compiler.","pos":[0,149]},{"content":"You define the interface within a library statement and assign it an interface ID with the universal unique identifier (UUID) attribute, as the following example demonstrates.","pos":[150,325]}]}]},{"pos":[3113,3345],"content":"The MIDL compiler produces several output files. If the interface is defined in Old.idl, the output file Old_i.c defines a `const` variable with the interface identifier (IID) of the interface, as the following example demonstrates.","nodes":[{"content":"The MIDL compiler produces several output files.","pos":[0,48]},{"content":"If the interface is defined in Old.idl, the output file Old_i.c defines a <ph id=\"ph1\">`const`</ph> variable with the interface identifier (IID) of the interface, as the following example demonstrates.","pos":[49,232],"source":" If the interface is defined in Old.idl, the output file Old_i.c defines a `const` variable with the interface identifier (IID) of the interface, as the following example demonstrates."}]},{"pos":[3460,3592],"content":"The Old.h file is also produced by MIDL. It contains a C++ definition of the interface that can be included in your C++ source code.","nodes":[{"content":"The Old.h file is also produced by MIDL. It contains a C++ definition of the interface that can be included in your C++ source code.","pos":[0,132],"nodes":[{"content":"The Old.h file is also produced by MIDL.","pos":[0,40]},{"content":"It contains a C++ definition of the interface that can be included in your C++ source code.","pos":[41,132]}]}]},{"pos":[3601,3644],"content":"Implementing the ICustomMarshaler Interface","linkify":"Implementing the ICustomMarshaler Interface","nodes":[{"content":"Implementing the ICustomMarshaler Interface","pos":[0,43]}]},{"pos":[3648,3805],"content":"Your custom marshaler must implement the <xref:System.Runtime.InteropServices.ICustomMarshaler> interface to provide the appropriate wrappers to the runtime.","nodes":[{"content":"Your custom marshaler must implement the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.ICustomMarshaler&gt;</ph> interface to provide the appropriate wrappers to the runtime.","pos":[0,157],"source":"Your custom marshaler must implement the <xref:System.Runtime.InteropServices.ICustomMarshaler> interface to provide the appropriate wrappers to the runtime."}]},{"pos":[3812,3912],"content":"The following C# code displays the base interface that must be implemented by all custom marshalers.","nodes":[{"content":"The following C# code displays the base interface that must be implemented by all custom marshalers.","pos":[0,100]}]},{"pos":[3919,4454],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#2<ept id=\"p2\">](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#2)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#2<ept id=\"p4\">](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#2)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#2<ept id=\"p6\">](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#2)</ept><ept id=\"p5\">]</ept>","source":"[!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#2](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#2)]\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#2](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#2)]\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#2](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#2)]"},{"pos":[4461,4644],"content":"The <xref:System.Runtime.InteropServices.ICustomMarshaler> interface includes methods that provide conversion support, cleanup support, and information about the data to be marshaled.","nodes":[{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.ICustomMarshaler&gt;</ph> interface includes methods that provide conversion support, cleanup support, and information about the data to be marshaled.","pos":[0,183],"source":"The <xref:System.Runtime.InteropServices.ICustomMarshaler> interface includes methods that provide conversion support, cleanup support, and information about the data to be marshaled."}]},{"pos":[4651,4668],"content":"Type of operation","nodes":[{"content":"Type of operation","pos":[0,17]}]},{"pos":[4669,4692],"content":"ICustomMarshaler method","nodes":[{"content":"ICustomMarshaler method","pos":[0,23]}]},{"pos":[4693,4704],"content":"Description","nodes":[{"content":"Description","pos":[0,11]}]},{"pos":[4785,4825],"content":"Conversion (from native to managed code)","nodes":[{"content":"Conversion (from native to managed code)","pos":[0,40]}]},{"pos":[4826,4906],"content":"<xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A>","nodes":[]},{"pos":[4907,5168],"content":"Marshals a pointer to native data into a managed object. This method returns a custom runtime callable wrapper (RCW) that can marshal the unmanaged interface that is passed as an argument. The marshaler should return an instance of the custom RCW for that type.","nodes":[{"content":"Marshals a pointer to native data into a managed object. This method returns a custom runtime callable wrapper (RCW) that can marshal the unmanaged interface that is passed as an argument. The marshaler should return an instance of the custom RCW for that type.","pos":[0,261],"nodes":[{"content":"Marshals a pointer to native data into a managed object.","pos":[0,56]},{"content":"This method returns a custom runtime callable wrapper (RCW) that can marshal the unmanaged interface that is passed as an argument.","pos":[57,188]},{"content":"The marshaler should return an instance of the custom RCW for that type.","pos":[189,261]}]}]},{"pos":[5173,5213],"content":"Conversion (from managed to native code)","nodes":[{"content":"Conversion (from managed to native code)","pos":[0,40]}]},{"pos":[5214,5294],"content":"<xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A>","nodes":[]},{"pos":[5295,5550],"content":"Marshals a managed object into a pointer to native data. This method returns a custom COM callable wrapper (CCW) that can marshal the managed interface that is passed as an argument. The marshaler should return an instance of the custom CCW for that type.","nodes":[{"content":"Marshals a managed object into a pointer to native data. This method returns a custom COM callable wrapper (CCW) that can marshal the managed interface that is passed as an argument. The marshaler should return an instance of the custom CCW for that type.","pos":[0,255],"nodes":[{"content":"Marshals a managed object into a pointer to native data.","pos":[0,56]},{"content":"This method returns a custom COM callable wrapper (CCW) that can marshal the managed interface that is passed as an argument.","pos":[57,182]},{"content":"The marshaler should return an instance of the custom CCW for that type.","pos":[183,255]}]}]},{"pos":[5555,5579],"content":"Cleanup (of native code)","nodes":[{"content":"Cleanup (of native code)","pos":[0,24]}]},{"pos":[5580,5655],"content":"<xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData%2A>","nodes":[]},{"pos":[5656,5828],"content":"Enables the marshaler to clean up the native data (the CCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> method.","nodes":[{"content":"Enables the marshaler to clean up the native data (the CCW) that is returned by the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A&gt;</ph> method.","pos":[0,172],"source":"Enables the marshaler to clean up the native data (the CCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> method."}]},{"pos":[5833,5858],"content":"Cleanup (of managed code)","nodes":[{"content":"Cleanup (of managed code)","pos":[0,25]}]},{"pos":[5859,5935],"content":"<xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData%2A>","nodes":[]},{"pos":[5936,6109],"content":"Enables the marshaler to clean up the managed data (the RCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> method.","nodes":[{"content":"Enables the marshaler to clean up the managed data (the RCW) that is returned by the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A&gt;</ph> method.","pos":[0,173],"source":"Enables the marshaler to clean up the managed data (the RCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> method."}]},{"pos":[6114,6145],"content":"Information (about native code)","nodes":[{"content":"Information (about native code)","pos":[0,31]}]},{"pos":[6146,6221],"content":"<xref:System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize%2A>","nodes":[]},{"pos":[6222,6277],"content":"Returns the size of the unmanaged data to be marshaled.","nodes":[{"content":"Returns the size of the unmanaged data to be marshaled.","pos":[0,55]}]},{"pos":[6288,6298],"content":"Conversion","linkify":"Conversion","nodes":[{"content":"Conversion","pos":[0,10]}]},{"pos":[6302,6407],"content":"<xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A?displayProperty=fullName>","nodes":[]},{"pos":[6414,6675],"content":"Marshals a pointer to native data into a managed object. This method returns a custom runtime callable wrapper (RCW) that can marshal the unmanaged interface that is passed as an argument. The marshaler should return an instance of the custom RCW for that type.","nodes":[{"content":"Marshals a pointer to native data into a managed object. This method returns a custom runtime callable wrapper (RCW) that can marshal the unmanaged interface that is passed as an argument. The marshaler should return an instance of the custom RCW for that type.","pos":[0,261],"nodes":[{"content":"Marshals a pointer to native data into a managed object.","pos":[0,56]},{"content":"This method returns a custom runtime callable wrapper (RCW) that can marshal the unmanaged interface that is passed as an argument.","pos":[57,188]},{"content":"The marshaler should return an instance of the custom RCW for that type.","pos":[189,261]}]}]},{"pos":[6682,6787],"content":"<xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A?displayProperty=fullName>","nodes":[]},{"pos":[6794,7049],"content":"Marshals a managed object into a pointer to native data. This method returns a custom COM callable wrapper (CCW) that can marshal the managed interface that is passed as an argument. The marshaler should return an instance of the custom CCW for that type.","nodes":[{"content":"Marshals a managed object into a pointer to native data. This method returns a custom COM callable wrapper (CCW) that can marshal the managed interface that is passed as an argument. The marshaler should return an instance of the custom CCW for that type.","pos":[0,255],"nodes":[{"content":"Marshals a managed object into a pointer to native data.","pos":[0,56]},{"content":"This method returns a custom COM callable wrapper (CCW) that can marshal the managed interface that is passed as an argument.","pos":[57,182]},{"content":"The marshaler should return an instance of the custom CCW for that type.","pos":[183,255]}]}]},{"pos":[7059,7066],"content":"Cleanup","linkify":"Cleanup","nodes":[{"content":"Cleanup","pos":[0,7]}]},{"pos":[7070,7170],"content":"<xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData%2A?displayProperty=fullName>","nodes":[]},{"pos":[7177,7349],"content":"Enables the marshaler to clean up the native data (the CCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> method.","nodes":[{"content":"Enables the marshaler to clean up the native data (the CCW) that is returned by the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A&gt;</ph> method.","pos":[0,172],"source":"Enables the marshaler to clean up the native data (the CCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> method."}]},{"pos":[7356,7457],"content":"<xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData%2A?displayProperty=fullName>","nodes":[]},{"pos":[7464,7637],"content":"Enables the marshaler to clean up the managed data (the RCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> method.","nodes":[{"content":"Enables the marshaler to clean up the managed data (the RCW) that is returned by the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A&gt;</ph> method.","pos":[0,173],"source":"Enables the marshaler to clean up the managed data (the RCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> method."}]},{"pos":[7647,7663],"content":"Size Information","linkify":"Size Information","nodes":[{"content":"Size Information","pos":[0,16]}]},{"pos":[7667,7767],"content":"<xref:System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize%2A?displayProperty=fullName>","nodes":[]},{"pos":[7774,7829],"content":"Returns the size of the unmanaged data to be marshaled.","nodes":[{"content":"Returns the size of the unmanaged data to be marshaled.","pos":[0,55]}]},{"pos":[7838,7873],"content":"Implementing the GetInstance Method","linkify":"Implementing the GetInstance Method","nodes":[{"content":"Implementing the GetInstance Method","pos":[0,35]}]},{"pos":[7877,8435],"content":"In addition to implementing the <xref:System.Runtime.InteropServices.ICustomMarshaler> interface, custom marshalers must implement a `static` method called `GetInstance` that accepts a <xref:System.String> as a parameter and has a return type of <xref:System.Runtime.InteropServices.ICustomMarshaler>. This `static` method is called by the common language runtime's COM interop layer to instantiate an instance of the custom marshaler. The string that is passed to `GetInstance` is a cookie that the method can use to customize the returned custom marshaler.","nodes":[{"content":"In addition to implementing the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.ICustomMarshaler&gt;</ph> interface, custom marshalers must implement a <ph id=\"ph2\">`static`</ph> method called <ph id=\"ph3\">`GetInstance`</ph> that accepts a <ph id=\"ph4\">&lt;xref:System.String&gt;</ph> as a parameter and has a return type of <ph id=\"ph5\">&lt;xref:System.Runtime.InteropServices.ICustomMarshaler&gt;</ph>.","pos":[0,301],"source":"In addition to implementing the <xref:System.Runtime.InteropServices.ICustomMarshaler> interface, custom marshalers must implement a `static` method called `GetInstance` that accepts a <xref:System.String> as a parameter and has a return type of <xref:System.Runtime.InteropServices.ICustomMarshaler>."},{"content":"This <ph id=\"ph1\">`static`</ph> method is called by the common language runtime's COM interop layer to instantiate an instance of the custom marshaler.","pos":[302,435],"source":" This `static` method is called by the common language runtime's COM interop layer to instantiate an instance of the custom marshaler."},{"content":"The string that is passed to <ph id=\"ph1\">`GetInstance`</ph> is a cookie that the method can use to customize the returned custom marshaler.","pos":[436,558],"source":" The string that is passed to `GetInstance` is a cookie that the method can use to customize the returned custom marshaler."}]},{"pos":[8519,8546],"content":"Applying MarshalAsAttribute","linkify":"Applying MarshalAsAttribute","nodes":[{"content":"Applying MarshalAsAttribute","pos":[0,27]}]},{"pos":[8550,8713],"content":"To use a custom marshaler, you must apply the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute to the parameter or field that is being marshaled.","nodes":[{"content":"To use a custom marshaler, you must apply the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph> attribute to the parameter or field that is being marshaled.","pos":[0,163],"source":"To use a custom marshaler, you must apply the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute to the parameter or field that is being marshaled."}]},{"pos":[8720,9066],"content":"You must also pass the <xref:System.Runtime.InteropServices.UnmanagedType?displayProperty=fullName> enumeration value to the <xref:System.Runtime.InteropServices.MarshalAsAttribute>constructor. In addition, you must specify the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field with one of the following named parameters:","nodes":[{"content":"You must also pass the <xref:System.Runtime.InteropServices.UnmanagedType?displayProperty=fullName> enumeration value to the <xref:System.Runtime.InteropServices.MarshalAsAttribute>constructor. In addition, you must specify the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field with one of the following named parameters:","pos":[0,346],"nodes":[{"content":"You must also pass the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.UnmanagedType?displayProperty=fullName&gt;</ph> enumeration value to the <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph>constructor.","pos":[0,193],"source":"You must also pass the <xref:System.Runtime.InteropServices.UnmanagedType?displayProperty=fullName> enumeration value to the <xref:System.Runtime.InteropServices.MarshalAsAttribute>constructor."},{"content":"In addition, you must specify the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType&gt;</ph> field with one of the following named parameters:","pos":[194,346],"source":" In addition, you must specify the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field with one of the following named parameters:"}]}]},{"pos":[9076,9418],"content":"<xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> (required): The assembly-qualified name of the custom marshaler. The name should include the namespace and class of the custom marshaler. If the custom marshaler is not defined in the assembly it is used in, you must specify the name of the assembly in which it is defined.","nodes":[{"content":"<xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> (required): The assembly-qualified name of the custom marshaler. The name should include the namespace and class of the custom marshaler. If the custom marshaler is not defined in the assembly it is used in, you must specify the name of the assembly in which it is defined.","pos":[0,342],"nodes":[{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType&gt;</ph> (required): The assembly-qualified name of the custom marshaler.","pos":[0,133],"source":"<xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> (required): The assembly-qualified name of the custom marshaler."},{"content":"The name should include the namespace and class of the custom marshaler.","pos":[134,206]},{"content":"If the custom marshaler is not defined in the assembly it is used in, you must specify the name of the assembly in which it is defined.","pos":[207,342]}]}]},{"pos":[9430,9741],"content":"[!NOTE]\nYou can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef> field instead of the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field. <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef> takes a type that is easier to specify.","leadings":["","    >  "],"nodes":[{"content":"You can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef> field instead of the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field. <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef> takes a type that is easier to specify.","pos":[8,304],"nodes":[{"content":"You can use the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef&gt;</ph> field instead of the <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType&gt;</ph> field.","pos":[0,184],"source":"You can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef> field instead of the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field."},{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef&gt;</ph> takes a type that is easier to specify.","pos":[185,296],"source":" <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef> takes a type that is easier to specify."}]}]},{"pos":[9751,10142],"content":"<xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalCookie> (optional): A cookie that is passed to the custom marshaler. You can use the cookie to provide additional information to the marshaler. For example, if the same marshaler is used to provide a number of wrappers, the cookie identifies a specific wrapper. The cookie is passed to the `GetInstance` method of the marshaler.","nodes":[{"content":"<ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalCookie&gt;</ph> (optional): A cookie that is passed to the custom marshaler.","pos":[0,131],"source":"<xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalCookie> (optional): A cookie that is passed to the custom marshaler."},{"content":"You can use the cookie to provide additional information to the marshaler.","pos":[132,206]},{"content":"For example, if the same marshaler is used to provide a number of wrappers, the cookie identifies a specific wrapper.","pos":[207,324]},{"content":"The cookie is passed to the <ph id=\"ph1\">`GetInstance`</ph> method of the marshaler.","pos":[325,391],"source":" The cookie is passed to the `GetInstance` method of the marshaler."}]},{"pos":[10149,10474],"content":"The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute identifies the custom marshaler so it can activate the appropriate wrapper. The common language runtime's interop service then examines the attribute and creates the custom marshaler the first time the argument (parameter or field) needs to be marshaled.","nodes":[{"content":"The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute identifies the custom marshaler so it can activate the appropriate wrapper. The common language runtime's interop service then examines the attribute and creates the custom marshaler the first time the argument (parameter or field) needs to be marshaled.","pos":[0,325],"nodes":[{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph> attribute identifies the custom marshaler so it can activate the appropriate wrapper.","pos":[0,146],"source":"The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute identifies the custom marshaler so it can activate the appropriate wrapper."},{"content":"The common language runtime's interop service then examines the attribute and creates the custom marshaler the first time the argument (parameter or field) needs to be marshaled.","pos":[147,325]}]}]},{"pos":[10481,10757],"content":"The runtime then calls the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> and <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> methods on the custom marshaler to activate the correct wrapper to handle the call.","nodes":[{"content":"The runtime then calls the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A&gt;</ph> and <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A&gt;</ph> methods on the custom marshaler to activate the correct wrapper to handle the call.","pos":[0,276],"source":"The runtime then calls the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> and <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> methods on the custom marshaler to activate the correct wrapper to handle the call."}]},{"pos":[10766,10790],"content":"Using a Custom Marshaler","linkify":"Using a Custom Marshaler","nodes":[{"content":"Using a Custom Marshaler","pos":[0,24]}]},{"pos":[10794,10971],"content":"When the custom marshaler is complete, you can use it as a custom wrapper for a particular type. The following example shows the definition of the `IUserData` managed interface:","nodes":[{"content":"When the custom marshaler is complete, you can use it as a custom wrapper for a particular type.","pos":[0,96]},{"content":"The following example shows the definition of the <ph id=\"ph1\">`IUserData`</ph> managed interface:","pos":[97,177],"source":" The following example shows the definition of the `IUserData` managed interface:"}]},{"pos":[10978,11513],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#3<ept id=\"p2\">](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#3)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#3<ept id=\"p4\">](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#3)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#3<ept id=\"p6\">](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#3)</ept><ept id=\"p5\">]</ept>","source":"[!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#3](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#3)]\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#3](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#3)]\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#3](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#3)]"},{"pos":[11520,11942],"content":"In the following example, the `IUserData` interface uses the `NewOldMarshaler` custom marshaler to enable unmanaged client applications to pass an `IOld` interface to the `DoSomeStuff` method. The managed description of the `DoSomeStuff` method takes an `INew` interface, as shown in the previous example, whereas the unmanaged version of `DoSomeStuff` takes an `IOld` interface pointer, as shown in the following example.","nodes":[{"content":"In the following example, the <ph id=\"ph1\">`IUserData`</ph> interface uses the <ph id=\"ph2\">`NewOldMarshaler`</ph> custom marshaler to enable unmanaged client applications to pass an <ph id=\"ph3\">`IOld`</ph> interface to the <ph id=\"ph4\">`DoSomeStuff`</ph> method.","pos":[0,192],"source":"In the following example, the `IUserData` interface uses the `NewOldMarshaler` custom marshaler to enable unmanaged client applications to pass an `IOld` interface to the `DoSomeStuff` method."},{"content":"The managed description of the <ph id=\"ph1\">`DoSomeStuff`</ph> method takes an <ph id=\"ph2\">`INew`</ph> interface, as shown in the previous example, whereas the unmanaged version of <ph id=\"ph3\">`DoSomeStuff`</ph> takes an <ph id=\"ph4\">`IOld`</ph> interface pointer, as shown in the following example.","pos":[193,422],"source":" The managed description of the `DoSomeStuff` method takes an `INew` interface, as shown in the previous example, whereas the unmanaged version of `DoSomeStuff` takes an `IOld` interface pointer, as shown in the following example."}]},{"pos":[12174,12590],"content":"The type library that is generated by exporting the managed definition of `IUserData` yields the unmanaged definition shown in this example instead of the standard definition. The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute applied to the `INew` argument in the managed definition of the `DoSomeStuff` method indicates that the argument uses a custom marshaler, as the following example shows.","nodes":[{"content":"The type library that is generated by exporting the managed definition of <ph id=\"ph1\">`IUserData`</ph> yields the unmanaged definition shown in this example instead of the standard definition.","pos":[0,175],"source":"The type library that is generated by exporting the managed definition of `IUserData` yields the unmanaged definition shown in this example instead of the standard definition."},{"content":"The <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph> attribute applied to the <ph id=\"ph2\">`INew`</ph> argument in the managed definition of the <ph id=\"ph3\">`DoSomeStuff`</ph> method indicates that the argument uses a custom marshaler, as the following example shows.","pos":[176,416],"source":" The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute applied to the `INew` argument in the managed definition of the `DoSomeStuff` method indicates that the argument uses a custom marshaler, as the following example shows."}]},{"pos":[12597,13132],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#4<ept id=\"p2\">](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#4)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#4<ept id=\"p4\">](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#4)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#4<ept id=\"p6\">](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#4)</ept><ept id=\"p5\">]</ept>","source":"[!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#4](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#4)]\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#4](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#4)]\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#4](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#4)]"},{"pos":[13139,13674],"content":"<bpt id=\"p1\">[!code-cpp</bpt><bpt id=\"p2\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#5<ept id=\"p2\">](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#5)</ept><ept id=\"p1\">]</ept> <bpt id=\"p3\">[!code-csharp</bpt><bpt id=\"p4\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#5<ept id=\"p4\">](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#5)</ept><ept id=\"p3\">]</ept> <bpt id=\"p5\">[!code-vb</bpt><bpt id=\"p6\">[</bpt>System.Runtime.InteropServices.ICustomMarshaler#5<ept id=\"p6\">](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#5)</ept><ept id=\"p5\">]</ept>","source":"[!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#5](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#5)]\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#5](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#5)]\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#5](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#5)]"},{"pos":[13681,13944],"content":"In the previous examples, the first parameter provided to the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute&gt;</ph> attribute is the <ph id=\"ph2\">&lt;xref:System.Runtime.InteropServices.UnmanagedType?displayProperty=fullName&gt;</ph> enumeration value <ph id=\"ph3\">`UnmanagedType.CustomMarshaler`</ph>.","source":"In the previous examples, the first parameter provided to the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute is the <xref:System.Runtime.InteropServices.UnmanagedType?displayProperty=fullName> enumeration value `UnmanagedType.CustomMarshaler`."},{"pos":[13951,14237],"content":"The second parameter is the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field, which provides the assembly-qualified name of the custom marshaler. This name consists of the namespace and class of the custom marshaler (`MarshalType=\"MyCompany.NewOldMarshaler\"`).","nodes":[{"content":"The second parameter is the <ph id=\"ph1\">&lt;xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType&gt;</ph> field, which provides the assembly-qualified name of the custom marshaler.","pos":[0,171],"source":"The second parameter is the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field, which provides the assembly-qualified name of the custom marshaler."},{"content":"This name consists of the namespace and class of the custom marshaler (<ph id=\"ph1\">`MarshalType=\"MyCompany.NewOldMarshaler\"`</ph>).","pos":[172,286],"source":" This name consists of the namespace and class of the custom marshaler (`MarshalType=\"MyCompany.NewOldMarshaler\"`)."}]}],"pos":[962,15340],"yaml":true,"extradata":"MT"},{"content":"Performs necessary cleanup of the managed data when it is no longer needed.","nodes":[{"pos":[0,75],"content":"Performs necessary cleanup of the managed data when it is no longer needed.","nodes":[{"content":"Performs necessary cleanup of the managed data when it is no longer needed.","pos":[0,75]}]}],"pos":[17244,17320],"yaml":true},{"content":"The managed object to be destroyed.","nodes":[{"pos":[0,35],"content":"The managed object to be destroyed.","nodes":[{"content":"The managed object to be destroyed.","pos":[0,35]}]}],"pos":[17477,17513],"yaml":true},{"content":"Performs necessary cleanup of the unmanaged data when it is no longer needed.","nodes":[{"pos":[0,77],"content":"Performs necessary cleanup of the unmanaged data when it is no longer needed.","nodes":[{"content":"Performs necessary cleanup of the unmanaged data when it is no longer needed.","pos":[0,77]}]}],"pos":[18951,19029],"yaml":true},{"content":"A pointer to the unmanaged data to be destroyed.","nodes":[{"pos":[0,48],"content":"A pointer to the unmanaged data to be destroyed.","nodes":[{"content":"A pointer to the unmanaged data to be destroyed.","pos":[0,48]}]}],"pos":[19187,19236],"yaml":true},{"content":"Returns the size of the native data to be marshaled.","nodes":[{"pos":[0,52],"content":"Returns the size of the native data to be marshaled.","nodes":[{"content":"Returns the size of the native data to be marshaled.","pos":[0,52]}]}],"pos":[20610,20663],"yaml":true},{"content":"The size, in bytes, of the native data.","nodes":[{"pos":[0,39],"content":"The size, in bytes, of the native data.","nodes":[{"content":"The size, in bytes, of the native data.","pos":[0,39]}]}],"pos":[20794,20834],"yaml":true},{"content":"Converts the managed data to unmanaged data.","nodes":[{"pos":[0,44],"content":"Converts the managed data to unmanaged data.","nodes":[{"content":"Converts the managed data to unmanaged data.","pos":[0,44]}]}],"pos":[22301,22346],"yaml":true},{"content":"The managed object to be converted.","nodes":[{"pos":[0,35],"content":"The managed object to be converted.","nodes":[{"content":"The managed object to be converted.","pos":[0,35]}]}],"pos":[22509,22545],"yaml":true},{"content":"A pointer to the COM view of the managed object.","nodes":[{"pos":[0,48],"content":"A pointer to the COM view of the managed object.","nodes":[{"content":"A pointer to the COM view of the managed object.","pos":[0,48]}]}],"pos":[22602,22651],"yaml":true},{"content":"Converts the unmanaged data to managed data.","nodes":[{"pos":[0,44],"content":"Converts the unmanaged data to managed data.","nodes":[{"content":"Converts the unmanaged data to managed data.","pos":[0,44]}]}],"pos":[24123,24168],"yaml":true},{"content":"A pointer to the unmanaged data to be wrapped.","nodes":[{"pos":[0,46],"content":"A pointer to the unmanaged data to be wrapped.","nodes":[{"content":"A pointer to the unmanaged data to be wrapped.","pos":[0,46]}]}],"pos":[24333,24380],"yaml":true},{"content":"An object that represents the managed view of the COM data.","nodes":[{"pos":[0,59],"content":"An object that represents the managed view of the COM data.","nodes":[{"content":"An object that represents the managed view of the COM data.","pos":[0,59]}]}],"pos":[24437,24497],"yaml":true}],"content":"### YamlMime:ManagedReference\nitems:\n- uid: System.Runtime.InteropServices.ICustomMarshaler\n  commentId: T:System.Runtime.InteropServices.ICustomMarshaler\n  id: ICustomMarshaler\n  children:\n  - System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData(System.Object)\n  - System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData(System.IntPtr)\n  - System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize\n  - System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative(System.Object)\n  - System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged(System.IntPtr)\n  langs:\n  - csharp\n  name: ICustomMarshaler\n  nameWithType: ICustomMarshaler\n  fullName: System.Runtime.InteropServices.ICustomMarshaler\n  type: Interface\n  assemblies:\n  - mscorlib\n  - netstandard\n  - System.Runtime.InteropServices\n  namespace: System.Runtime.InteropServices\n  summary: Provides custom wrappers for handling method calls.\n  remarks: \"A marshaler provides a bridge between the functionality of old and new interfaces. Custom marshaling provides the following benefits:  \\n  \\n-   It enables client applications that were designed to work with an old interface to also work with servers that implement a new interface.  \\n  \\n-   It enables client applications built to work with a new interface to work with servers that implement an old interface.  \\n  \\n If you have an interface that introduces different marshaling behavior or that is exposed to the Component Object Model (COM) in a different way, you can design a custom marshaler instead of using the interop marshaler. By using a custom marshaler, you can minimize the distinction between new .NET Framework components and existing COM components.  \\n  \\n For example, suppose that you are developing a managed interface called `INew`. When this interface is exposed to COM through a standard COM callable wrapper (CCW), it has the same methods as the managed interface and uses the marshaling rules built into the interop marshaler. Now suppose that a well-known COM interface called `IOld` already provides the same functionality as the `INew` interface. By designing a custom marshaler, you can provide an unmanaged implementation of `IOld` that simply delegates the calls to the managed implementation of the `INew` interface. Therefore, the custom marshaler acts as a bridge between the managed and unmanaged interfaces.  \\n  \\n> [!NOTE]\\n>  Custom marshalers are not invoked when calling from managed code to unmanaged code on a dispatch-only interface.  \\n  \\n## Defining the Marshaling Type  \\n Before you can build a custom marshaler, you must define the managed and unmanaged interfaces that will be marshaled. These interfaces commonly perform the same function but are exposed differently to managed and unmanaged objects.  \\n  \\n A managed compiler produces a managed interface from metadata, and the resulting interface looks like any other managed interface. The following example shows a typical interface.  \\n  \\n [!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#1](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#1)]\\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#1](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#1)]\\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#1](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#1)]  \\n  \\n You define the unmanaged type in Interface Definition Language (IDL) and compile it with the Microsoft Interface Definition Language (MIDL) compiler. You define the interface within a library statement and assign it an interface ID with the universal unique identifier (UUID) attribute, as the following example demonstrates.  \\n  \\n```  \\n [uuid(9B2BAADA-0705-11D3-A0CD-00C04FA35826)]  \\nlibrary OldLib {  \\n     [uuid(9B2BAADD-0705-11D3-A0CD-00C04FA35826)]  \\n     interface IOld : IUnknown  \\n         HRESULT OldMethod();  \\n}  \\n```  \\n  \\n The MIDL compiler produces several output files. If the interface is defined in Old.idl, the output file Old_i.c defines a `const` variable with the interface identifier (IID) of the interface, as the following example demonstrates.  \\n  \\n```  \\nconst IID IID_IOld = {0x9B2BAADD,0x0705,0x11D3,{0xA0,0xCD,0x00,0xC0,0x4F,0xA3,0x58,0x26}};  \\n```  \\n  \\n The Old.h file is also produced by MIDL. It contains a C++ definition of the interface that can be included in your C++ source code.  \\n  \\n## Implementing the ICustomMarshaler Interface  \\n Your custom marshaler must implement the <xref:System.Runtime.InteropServices.ICustomMarshaler> interface to provide the appropriate wrappers to the runtime.  \\n  \\n The following C# code displays the base interface that must be implemented by all custom marshalers.  \\n  \\n [!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#2](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#2)]\\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#2](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#2)]\\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#2](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#2)]  \\n  \\n The <xref:System.Runtime.InteropServices.ICustomMarshaler> interface includes methods that provide conversion support, cleanup support, and information about the data to be marshaled.  \\n  \\n|Type of operation|ICustomMarshaler method|Description|  \\n|-----------------------|-----------------------------|-----------------|  \\n|Conversion (from native to managed code)|<xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A>|Marshals a pointer to native data into a managed object. This method returns a custom runtime callable wrapper (RCW) that can marshal the unmanaged interface that is passed as an argument. The marshaler should return an instance of the custom RCW for that type.|  \\n|Conversion (from managed to native code)|<xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A>|Marshals a managed object into a pointer to native data. This method returns a custom COM callable wrapper (CCW) that can marshal the managed interface that is passed as an argument. The marshaler should return an instance of the custom CCW for that type.|  \\n|Cleanup (of native code)|<xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData%2A>|Enables the marshaler to clean up the native data (the CCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> method.|  \\n|Cleanup (of managed code)|<xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData%2A>|Enables the marshaler to clean up the managed data (the RCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> method.|  \\n|Information (about native code)|<xref:System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize%2A>|Returns the size of the unmanaged data to be marshaled.|  \\n  \\n### Conversion  \\n <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A?displayProperty=fullName>  \\n  \\n Marshals a pointer to native data into a managed object. This method returns a custom runtime callable wrapper (RCW) that can marshal the unmanaged interface that is passed as an argument. The marshaler should return an instance of the custom RCW for that type.  \\n  \\n <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A?displayProperty=fullName>  \\n  \\n Marshals a managed object into a pointer to native data. This method returns a custom COM callable wrapper (CCW) that can marshal the managed interface that is passed as an argument. The marshaler should return an instance of the custom CCW for that type.  \\n  \\n### Cleanup  \\n <xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData%2A?displayProperty=fullName>  \\n  \\n Enables the marshaler to clean up the native data (the CCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> method.  \\n  \\n <xref:System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData%2A?displayProperty=fullName>  \\n  \\n Enables the marshaler to clean up the managed data (the RCW) that is returned by the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> method.  \\n  \\n### Size Information  \\n <xref:System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize%2A?displayProperty=fullName>  \\n  \\n Returns the size of the unmanaged data to be marshaled.  \\n  \\n## Implementing the GetInstance Method  \\n In addition to implementing the <xref:System.Runtime.InteropServices.ICustomMarshaler> interface, custom marshalers must implement a `static` method called `GetInstance` that accepts a <xref:System.String> as a parameter and has a return type of <xref:System.Runtime.InteropServices.ICustomMarshaler>. This `static` method is called by the common language runtime's COM interop layer to instantiate an instance of the custom marshaler. The string that is passed to `GetInstance` is a cookie that the method can use to customize the returned custom marshaler.  \\n  \\n```  \\nstatic ICustomMarshaler *GetInstance(String *pstrCookie);  \\n```  \\n  \\n## Applying MarshalAsAttribute  \\n To use a custom marshaler, you must apply the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute to the parameter or field that is being marshaled.  \\n  \\n You must also pass the <xref:System.Runtime.InteropServices.UnmanagedType?displayProperty=fullName> enumeration value to the <xref:System.Runtime.InteropServices.MarshalAsAttribute>constructor. In addition, you must specify the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field with one of the following named parameters:  \\n  \\n-   <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> (required): The assembly-qualified name of the custom marshaler. The name should include the namespace and class of the custom marshaler. If the custom marshaler is not defined in the assembly it is used in, you must specify the name of the assembly in which it is defined.  \\n  \\n    > [!NOTE]\\n    >  You can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef> field instead of the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field. <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalTypeRef> takes a type that is easier to specify.  \\n  \\n-   <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalCookie> (optional): A cookie that is passed to the custom marshaler. You can use the cookie to provide additional information to the marshaler. For example, if the same marshaler is used to provide a number of wrappers, the cookie identifies a specific wrapper. The cookie is passed to the `GetInstance` method of the marshaler.  \\n  \\n The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute identifies the custom marshaler so it can activate the appropriate wrapper. The common language runtime's interop service then examines the attribute and creates the custom marshaler the first time the argument (parameter or field) needs to be marshaled.  \\n  \\n The runtime then calls the <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged%2A> and <xref:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative%2A> methods on the custom marshaler to activate the correct wrapper to handle the call.  \\n  \\n## Using a Custom Marshaler  \\n When the custom marshaler is complete, you can use it as a custom wrapper for a particular type. The following example shows the definition of the `IUserData` managed interface:  \\n  \\n [!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#3](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#3)]\\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#3](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#3)]\\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#3](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#3)]  \\n  \\n In the following example, the `IUserData` interface uses the `NewOldMarshaler` custom marshaler to enable unmanaged client applications to pass an `IOld` interface to the `DoSomeStuff` method. The managed description of the `DoSomeStuff` method takes an `INew` interface, as shown in the previous example, whereas the unmanaged version of `DoSomeStuff` takes an `IOld` interface pointer, as shown in the following example.  \\n  \\n```  \\n[uuid(9B2BAADA-0705-11D3-A0CD-00C04FA35826)]  \\nlibrary UserLib {  \\n     [uuid(9B2BABCD-0705-11D3-A0CD-00C04FA35826)]  \\n     interface IUserData : IUnknown  \\n         HRESULT DoSomeStuff(IUnknown* pIOld);  \\n}  \\n```  \\n  \\n The type library that is generated by exporting the managed definition of `IUserData` yields the unmanaged definition shown in this example instead of the standard definition. The <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute applied to the `INew` argument in the managed definition of the `DoSomeStuff` method indicates that the argument uses a custom marshaler, as the following example shows.  \\n  \\n [!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#4](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#4)]\\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#4](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#4)]\\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#4](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#4)]  \\n  \\n [!code-cpp[System.Runtime.InteropServices.ICustomMarshaler#5](~/samples/snippets/cpp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cpp/source.cpp#5)]\\n [!code-csharp[System.Runtime.InteropServices.ICustomMarshaler#5](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/cs/source.cs#5)]\\n [!code-vb[System.Runtime.InteropServices.ICustomMarshaler#5](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.runtime.interopservices.icustommarshaler/vb/source.vb#5)]  \\n  \\n In the previous examples, the first parameter provided to the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute is the <xref:System.Runtime.InteropServices.UnmanagedType?displayProperty=fullName> enumeration value `UnmanagedType.CustomMarshaler`.  \\n  \\n The second parameter is the <xref:System.Runtime.InteropServices.MarshalAsAttribute.MarshalType> field, which provides the assembly-qualified name of the custom marshaler. This name consists of the namespace and class of the custom marshaler (`MarshalType=\\\"MyCompany.NewOldMarshaler\\\"`).\"\n  syntax:\n    content: >-\n      [System.Runtime.InteropServices.ComVisible(true)]\n\n      public interface ICustomMarshaler\n  derivedClasses:\n  - System.Runtime.InteropServices.CustomMarshalers.EnumerableToDispatchMarshaler\n  - System.Runtime.InteropServices.CustomMarshalers.EnumeratorToEnumVariantMarshaler\n  - System.Runtime.InteropServices.CustomMarshalers.ExpandoToDispatchExMarshaler\n  - System.Runtime.InteropServices.CustomMarshalers.TypeToTypeInfoMarshaler\n  implements: []\n  attributes:\n  - type: System.Runtime.InteropServices.ComVisibleAttribute\n  version:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n  ms.technology:\n  - dotnet-standard\n  author: rpetrusha\n  ms.author: ronpet\n  manager: wpickett\n- uid: System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData(System.Object)\n  commentId: M:System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData(System.Object)\n  id: CleanUpManagedData(System.Object)\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  langs:\n  - csharp\n  name: CleanUpManagedData(Object)\n  nameWithType: ICustomMarshaler.CleanUpManagedData(Object)\n  fullName: ICustomMarshaler.CleanUpManagedData(Object)\n  type: Method\n  assemblies:\n  - mscorlib\n  - netstandard\n  - System.Runtime.InteropServices\n  namespace: System.Runtime.InteropServices\n  summary: Performs necessary cleanup of the managed data when it is no longer needed.\n  syntax:\n    content: public void CleanUpManagedData (object ManagedObj);\n    parameters:\n    - id: ManagedObj\n      type: System.Object\n      description: The managed object to be destroyed.\n  overload: System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData*\n  exceptions: []\n  version:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n  ms.technology:\n  - dotnet-standard\n  author: rpetrusha\n  ms.author: ronpet\n  manager: wpickett\n- uid: System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData(System.IntPtr)\n  commentId: M:System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData(System.IntPtr)\n  id: CleanUpNativeData(System.IntPtr)\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  langs:\n  - csharp\n  name: CleanUpNativeData(IntPtr)\n  nameWithType: ICustomMarshaler.CleanUpNativeData(IntPtr)\n  fullName: ICustomMarshaler.CleanUpNativeData(IntPtr)\n  type: Method\n  assemblies:\n  - mscorlib\n  - netstandard\n  - System.Runtime.InteropServices\n  namespace: System.Runtime.InteropServices\n  summary: Performs necessary cleanup of the unmanaged data when it is no longer needed.\n  syntax:\n    content: public void CleanUpNativeData (IntPtr pNativeData);\n    parameters:\n    - id: pNativeData\n      type: System.IntPtr\n      description: A pointer to the unmanaged data to be destroyed.\n  overload: System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData*\n  exceptions: []\n  version:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n  ms.technology:\n  - dotnet-standard\n  author: rpetrusha\n  ms.author: ronpet\n  manager: wpickett\n- uid: System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize\n  commentId: M:System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize\n  id: GetNativeDataSize\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  langs:\n  - csharp\n  name: GetNativeDataSize()\n  nameWithType: ICustomMarshaler.GetNativeDataSize()\n  fullName: ICustomMarshaler.GetNativeDataSize()\n  type: Method\n  assemblies:\n  - mscorlib\n  - netstandard\n  - System.Runtime.InteropServices\n  namespace: System.Runtime.InteropServices\n  summary: Returns the size of the native data to be marshaled.\n  syntax:\n    content: public int GetNativeDataSize ();\n    parameters: []\n    return:\n      type: System.Int32\n      description: The size, in bytes, of the native data.\n  overload: System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize*\n  exceptions: []\n  version:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n  ms.technology:\n  - dotnet-standard\n  author: rpetrusha\n  ms.author: ronpet\n  manager: wpickett\n- uid: System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative(System.Object)\n  commentId: M:System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative(System.Object)\n  id: MarshalManagedToNative(System.Object)\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  langs:\n  - csharp\n  name: MarshalManagedToNative(Object)\n  nameWithType: ICustomMarshaler.MarshalManagedToNative(Object)\n  fullName: ICustomMarshaler.MarshalManagedToNative(Object)\n  type: Method\n  assemblies:\n  - mscorlib\n  - netstandard\n  - System.Runtime.InteropServices\n  namespace: System.Runtime.InteropServices\n  summary: Converts the managed data to unmanaged data.\n  syntax:\n    content: public IntPtr MarshalManagedToNative (object ManagedObj);\n    parameters:\n    - id: ManagedObj\n      type: System.Object\n      description: The managed object to be converted.\n    return:\n      type: System.IntPtr\n      description: A pointer to the COM view of the managed object.\n  overload: System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative*\n  exceptions: []\n  version:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n  ms.technology:\n  - dotnet-standard\n  author: rpetrusha\n  ms.author: ronpet\n  manager: wpickett\n- uid: System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged(System.IntPtr)\n  commentId: M:System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged(System.IntPtr)\n  id: MarshalNativeToManaged(System.IntPtr)\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  langs:\n  - csharp\n  name: MarshalNativeToManaged(IntPtr)\n  nameWithType: ICustomMarshaler.MarshalNativeToManaged(IntPtr)\n  fullName: ICustomMarshaler.MarshalNativeToManaged(IntPtr)\n  type: Method\n  assemblies:\n  - mscorlib\n  - netstandard\n  - System.Runtime.InteropServices\n  namespace: System.Runtime.InteropServices\n  summary: Converts the unmanaged data to managed data.\n  syntax:\n    content: public object MarshalNativeToManaged (IntPtr pNativeData);\n    parameters:\n    - id: pNativeData\n      type: System.IntPtr\n      description: A pointer to the unmanaged data to be wrapped.\n    return:\n      type: System.Object\n      description: An object that represents the managed view of the COM data.\n  overload: System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged*\n  exceptions: []\n  version:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n  ms.technology:\n  - dotnet-standard\n  author: rpetrusha\n  ms.author: ronpet\n  manager: wpickett\nreferences:\n- uid: System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData(System.Object)\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  isExternal: false\n  name: CleanUpManagedData(Object)\n  nameWithType: ICustomMarshaler.CleanUpManagedData(Object)\n  fullName: ICustomMarshaler.CleanUpManagedData(Object)\n- uid: System.Object\n  parent: System\n  isExternal: false\n  name: Object\n  nameWithType: Object\n  fullName: System.Object\n- uid: System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData(System.IntPtr)\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  isExternal: false\n  name: CleanUpNativeData(IntPtr)\n  nameWithType: ICustomMarshaler.CleanUpNativeData(IntPtr)\n  fullName: ICustomMarshaler.CleanUpNativeData(IntPtr)\n- uid: System.IntPtr\n  parent: System\n  isExternal: false\n  name: IntPtr\n  nameWithType: IntPtr\n  fullName: System.IntPtr\n- uid: System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  isExternal: false\n  name: GetNativeDataSize()\n  nameWithType: ICustomMarshaler.GetNativeDataSize()\n  fullName: ICustomMarshaler.GetNativeDataSize()\n- uid: System.Int32\n  parent: System\n  isExternal: false\n  name: Int32\n  nameWithType: Int32\n  fullName: System.Int32\n- uid: System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative(System.Object)\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  isExternal: false\n  name: MarshalManagedToNative(Object)\n  nameWithType: ICustomMarshaler.MarshalManagedToNative(Object)\n  fullName: ICustomMarshaler.MarshalManagedToNative(Object)\n- uid: System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged(System.IntPtr)\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  isExternal: false\n  name: MarshalNativeToManaged(IntPtr)\n  nameWithType: ICustomMarshaler.MarshalNativeToManaged(IntPtr)\n  fullName: ICustomMarshaler.MarshalNativeToManaged(IntPtr)\n- uid: System.Runtime.InteropServices.ICustomMarshaler.CleanUpManagedData*\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  isExternal: false\n  name: CleanUpManagedData\n  nameWithType: ICustomMarshaler.CleanUpManagedData\n  fullName: ICustomMarshaler.CleanUpManagedData\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n- uid: System.Runtime.InteropServices.ICustomMarshaler.CleanUpNativeData*\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  isExternal: false\n  name: CleanUpNativeData\n  nameWithType: ICustomMarshaler.CleanUpNativeData\n  fullName: ICustomMarshaler.CleanUpNativeData\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n- uid: System.Runtime.InteropServices.ICustomMarshaler.GetNativeDataSize*\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  isExternal: false\n  name: GetNativeDataSize\n  nameWithType: ICustomMarshaler.GetNativeDataSize\n  fullName: ICustomMarshaler.GetNativeDataSize\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n- uid: System.Runtime.InteropServices.ICustomMarshaler.MarshalManagedToNative*\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  isExternal: false\n  name: MarshalManagedToNative\n  nameWithType: ICustomMarshaler.MarshalManagedToNative\n  fullName: ICustomMarshaler.MarshalManagedToNative\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n- uid: System.Runtime.InteropServices.ICustomMarshaler.MarshalNativeToManaged*\n  parent: System.Runtime.InteropServices.ICustomMarshaler\n  isExternal: false\n  name: MarshalNativeToManaged\n  nameWithType: ICustomMarshaler.MarshalNativeToManaged\n  fullName: ICustomMarshaler.MarshalNativeToManaged\n  monikers:\n  - netcore-2.0\n  - netframework-4.5.1\n  - netframework-4.5.2\n  - netframework-4.5\n  - netframework-4.6.1\n  - netframework-4.6.2\n  - netframework-4.6\n  - netframework-4.7\n  - netstandard-2.0\n  - xamarinandroid-7.1\n  - xamarinios-10.8\n  - xamarinmac-3.0\n  content_git_url: https://github.com/dotnet/docs/blob/master/xml/System.Runtime.InteropServices/ICustomMarshaler.xml\n"}